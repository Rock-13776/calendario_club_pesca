<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendario Club de Pesca</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        #calendar {
            max-width: 900px;
            margin: 20px auto;
        }
    </style>
</head>
<body>

    <div id="calendar"></div>

    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

    <script>
        // ‚úÖ Funci√≥n para formatear fechas al formato ISO para FullCalendar
        function formatDate(ddmmyyyy) {
            if (!ddmmyyyy) return null;
            const [dd, mm, yyyy] = ddmmyyyy.split('/');

            // Verificaciones de valores
            if (!dd || !mm || !yyyy) return null;
            if (isNaN(dd) || isNaN(mm) || isNaN(yyyy)) return null;

            // Formato correcto para ISO
            const formattedDate = `${yyyy}-${String(mm).padStart(2, '0')}-${String(dd).padStart(2, '0')}`;
            return formattedDate;
        }

        // ‚úÖ Funci√≥n para cargar el CSV y transformar los datos en eventos
        function loadCSVData() {
            Papa.parse("eventos.csv", {
                download: true,
                header: true,
                complete: function(results) {
                    console.log("üìå Datos obtenidos del CSV:", results.data);

                    const events = results.data
                        .filter(row => row.Fecha && row.Modalidad)
                        .map(row => {
                            const formattedDate = formatDate(row.Fecha);
                            console.log(`üìÖ Fecha formateada: ${formattedDate}`); // <-- Verificaci√≥n
                            if (formattedDate) {
                                return {
                                    title: `${row.Modalidad} - ${row.Tipo ?? ''}`,
                                    start: formattedDate,
                                    modalidad: row.Modalidad ?? 'No disponible',
                                    tipo: row.Tipo ?? 'No disponible',
                                    categoria: row.Categoria ?? 'No disponible',
                                    lugar: row.Lugar ?? 'No disponible',
                                    notas: row.Notas ?? 'No disponible'
                                };
                            }
                            return null;
                        })
                        .filter(event => event !== null);

                    console.log("üìÖ Eventos procesados para el calendario:", events);

                    // Inicializaci√≥n del calendario
                    const calendarEl = document.getElementById('calendar');
                    const calendar = new FullCalendar.Calendar(calendarEl, {
                        initialView: 'dayGridMonth',
                        locale: 'es',
                        events: events,
                        eventClick: function(info) {
                            alert(`Modalidad: ${info.event.extendedProps.modalidad}
Tipo: ${info.event.extendedProps.tipo}
Categor√≠a: ${info.event.extendedProps.categoria}
Lugar: ${info.event.extendedProps.lugar}
Notas: ${info.event.extendedProps.notas}`);
                        }
                    });

                    calendar.render();
                },
                error: function(error) {
                    console.error("‚ùå Error al cargar el CSV:", error);
                }
            });
        }

        // ‚úÖ Llamada para cargar el CSV al iniciar la p√°gina
        document.addEventListener('DOMContentLoaded', loadCSVData);
    </script>
</body>
</html>
