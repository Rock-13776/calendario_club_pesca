<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Calendario Club de Pesca Costa Tropical 2025</title>
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px;
    }
    #calendar {
      max-width: 900px;
      margin: 0 auto;
      position: relative;
    }
    #calendar::before {
      content: "";
      background: url('https://i.imgur.com/BmpM8Rt.jpeg') no-repeat center center;
      background-size: contain;
      opacity: 0.2;
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
    }
  </style>
</head>
<body>
  <h1>Calendario de Eventos Club de Pesca Costa Tropical 2025</h1>
  <div id="calendar"></div>

  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const { Calendar } = FullCalendar;
      var calendarEl = document.getElementById('calendar');

      var calendar = new Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        locale: 'es',
        firstDay: 1,
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth,listMonth'
        },
        events: function (fetchInfo, successCallback, failureCallback) {
          fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vQKSb1EXkwC_yS66UHxKRFZe4GGeoSHrYIglb0fasG9XSUMHi-amqUB2Bn56tOSUfor3D97WOExPPPc/pub?gid=1560710832&single=true&output=csv')
            .then(response => response.text())
            .then(csvText => {
              Papa.parse(csvText, {
                header: true,
                delimiter: ";", // <<---- CLAVE AQUÍ
                skipEmptyLines: true,
                complete: function(results) {
                  const events = results.data.map(row => {
                    if (!row.FECHA || !row.MODALIDAD) return null;

                    const [dd, mm, yyyy] = row.FECHA.trim().split('/');
                    if (!dd || !mm || !yyyy) return null;

                    const isoDate = `${yyyy}-${mm.padStart(2, '0')}-${dd.padStart(2, '0')}`;

                    return {
                      title: `${row.MODALIDAD.trim()} - ${row.TIPO.trim()} (${row.CATEGORIA.trim()})`,
                      date: isoDate
                    };
                  }).filter(Boolean); // Elimina nulos
                  successCallback(events);
                },
                error: function(error) {
                  console.error('Error al parsear el CSV:', error);
                  failureCallback(error);
                }
              });
            })
            .catch(error => {
              console.error('Error al obtener el CSV:', error);
              failureCallback(error);
            });
        }
      });

      calendar.render();
    });
  </script>
</body>
</html>
